<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LeanCloud ä¸‹åˆ’çº¿å‘½åæµ‹è¯•</title>
    <!-- LeanCloud SDK with LiveQuery support -->
    <script src="//cdn.jsdelivr.net/npm/leancloud-storage@4.15.2/dist/av-live-query-min.js"></script>
    <style>
        body { 
            font-family: sans-serif; 
            max-width: 800px; 
            margin: 0 auto; 
            padding: 20px; 
            line-height: 1.6; 
        }
        .status { 
            padding: 15px; 
            margin: 10px 0; 
            border-radius: 8px; 
            border-left: 4px solid; 
        }
        .success { background: #d4edda; border-color: #28a745; color: #155724; }
        .error { background: #f8d7da; border-color: #dc3545; color: #721c24; }
        .info { background: #d1ecf1; border-color: #17a2b8; color: #0c5460; }
        .warning { background: #fff3cd; border-color: #ffc107; color: #856404; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            margin: 8px 4px;
        }
        button:hover { background: #0056b3; }
        pre { 
            background: #f8f9fa; 
            padding: 10px; 
            border-radius: 5px; 
            overflow-x: auto; 
            font-size: 12px;
        }
        .option-box {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <h1>ğŸ”§ Class å‘½åé—®é¢˜è§£å†³æ–¹æ¡ˆ</h1>
    
    <div class="status warning">
        <strong>âš ï¸ å‘ç°é—®é¢˜</strong><br>
        ä½ çš„ <code>annotation</code> Class æ˜¾ç¤º"æœªç»‘å®šåº”ç”¨"ï¼Œå¯¼è‡´è®¿é—®å¤±è´¥ã€‚
    </div>
    
    <div class="option-box">
        <h3>ğŸ› ï¸ è§£å†³æ–¹æ¡ˆé€‰æ‹©</h3>
        <p><strong>æ–¹æ¡ˆ1ï¼šä¿®å¤ç°æœ‰Classç»‘å®š</strong></p>
        <ol>
            <li>åœ¨LeanCloudæ§åˆ¶å°ï¼Œç‚¹å‡» <code>annotation</code> Class</li>
            <li>åœ¨"Classç»‘å®š"éƒ¨åˆ†ï¼Œé€‰æ‹©"è¯»ä¹¦è§’è½"åº”ç”¨</li>
            <li>ç‚¹å‡»"ç»‘å®š"æŒ‰é’®</li>
        </ol>
        
        <p><strong>æ–¹æ¡ˆ2ï¼šä½¿ç”¨ç³»ç»Ÿçº¦å®šå‘½åï¼ˆæ¨èï¼‰</strong></p>
        <p>åˆ›å»ºæ–°çš„ <code>_Annotation</code> Classï¼Œéµå¾ªç³»ç»Ÿå‘½åçº¦å®š</p>
        <button onclick="testSystemNaming()">ğŸ§ª æµ‹è¯•ç³»ç»Ÿçº¦å®šå‘½å</button>
        <button onclick="testOriginalNaming()">ğŸ§ª æµ‹è¯•åŸæœ‰å‘½å</button>
    </div>
    
    <div id="logs"></div>

    <script>
        const CONFIG = {
            appId: 'Q9m29iJ6xOVxOtDqmKamdsFX-gzGzoHsz',
            appKey: 'pK6oNXPcsmpyXarHT91xMtW8',
            serverURL: 'https://q9m29ij6.lc-cn-n1-shared.com'
        };

        let currentUser = null;

        function log(message, type = 'info') {
            const logs = document.getElementById('logs');
            const div = document.createElement('div');
            div.className = `status ${type}`;
            div.innerHTML = `<strong>${new Date().toLocaleTimeString()}</strong> ${message}`;
            logs.appendChild(div);
            console.log(message);
            div.scrollIntoView({ behavior: 'smooth' });
        }

        async function initLeanCloud() {
            try {
                if (typeof AV === 'undefined') {
                    throw new Error('LeanCloud SDK æœªåŠ è½½');
                }

                AV.init({
                    appId: CONFIG.appId,
                    appKey: CONFIG.appKey,
                    serverURL: CONFIG.serverURL
                });

                if (!currentUser) {
                    currentUser = await AV.User.loginAnonymously();
                    log(`âœ… LeanCloud åˆå§‹åŒ–å®Œæˆï¼Œç”¨æˆ·ID: ${currentUser.id.substring(0, 8)}...`, 'success');
                }
                return true;
            } catch (error) {
                log(`âŒ LeanCloud åˆå§‹åŒ–å¤±è´¥: ${error.message}`, 'error');
                return false;
            }
        }

        async function testSystemNaming() {
            log('ğŸ§ª æµ‹è¯•ç³»ç»Ÿçº¦å®šå‘½å: _Annotation', 'info');
            
            if (!(await initLeanCloud())) return;

            try {
                // å°è¯•åˆ›å»º _Annotation Class
                const AnnotationClass = AV.Object.extend('_Annotation');
                const testObj = new AnnotationClass();
                
                testObj.set('chapterId', 'test-chapter');
                testObj.set('selectedText', 'ç³»ç»Ÿå‘½åæµ‹è¯•');
                testObj.set('content', 'ä½¿ç”¨ _Annotation çš„æµ‹è¯•æ•°æ®');
                testObj.set('testType', 'system-naming');

                const saved = await testObj.save();
                log(`âœ… ç³»ç»Ÿå‘½åæµ‹è¯•æˆåŠŸï¼Class: _Annotation, æ–‡æ¡£ID: ${saved.id}`, 'success');

                // å°è¯•æŸ¥è¯¢
                const query = new AV.Query('_Annotation');
                const results = await query.find();
                log(`âœ… æŸ¥è¯¢æˆåŠŸï¼Œ_Annotation Class ä¸­æœ‰ ${results.length} æ¡è®°å½•`, 'success');

                log('<strong>ğŸ’¡ å»ºè®®ä½¿ç”¨ _Annotation ä½œä¸º Class åç§°</strong>', 'success');

            } catch (error) {
                log(`âŒ ç³»ç»Ÿå‘½åæµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                
                if (error.code === 101) {
                    log('ğŸ’¡ _Annotation Class ä¸å­˜åœ¨ï¼Œéœ€è¦å…ˆåˆ›å»º', 'warning');
                    log('ğŸ“ è¯·åœ¨LeanCloudæ§åˆ¶å°åˆ›å»ºåä¸º "_Annotation" çš„Class', 'info');
                }
            }
        }

        async function testOriginalNaming() {
            log('ğŸ§ª æµ‹è¯•åŸæœ‰å‘½å: annotation', 'info');
            
            if (!(await initLeanCloud())) return;

            try {
                // æµ‹è¯•åŸæœ‰çš„ annotation Class
                const query = new AV.Query('annotation');
                const results = await query.find();
                log(`âœ… åŸæœ‰å‘½åæµ‹è¯•æˆåŠŸï¼annotation Class ä¸­æœ‰ ${results.length} æ¡è®°å½•`, 'success');
                log('<strong>ğŸ’¡ åŸæœ‰ annotation Class ç»‘å®šæˆåŠŸï¼Œå¯ä»¥ç»§ç»­ä½¿ç”¨</strong>', 'success');

            } catch (error) {
                log(`âŒ åŸæœ‰å‘½åæµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                
                if (error.code === 101) {
                    log('ğŸ’¡ annotation Class æœªç»‘å®šåˆ°åº”ç”¨æˆ–æƒé™ä¸è¶³', 'warning');
                    log('ğŸ”§ è§£å†³æ–¹æ³•ï¼š', 'info');
                    log('1. åœ¨LeanCloudæ§åˆ¶å°ç‚¹å‡» annotation Class', 'info');
                    log('2. åœ¨Classç»‘å®šéƒ¨åˆ†é€‰æ‹©ä½ çš„åº”ç”¨', 'info');
                    log('3. ç‚¹å‡»ç»‘å®šæŒ‰é’®', 'info');
                    log('4. åˆ·æ–°é¡µé¢é‡æ–°æµ‹è¯•', 'info');
                }
            }
        }

        window.onload = () => {
            log('ğŸ”§ Class å‘½åé—®é¢˜è¯Šæ–­å·¥å…·å·²å¯åŠ¨', 'info');
            log('ğŸ“ è¯·é€‰æ‹©ä¸€ä¸ªæµ‹è¯•æ–¹æ¡ˆ', 'info');
        };
    </script>
</body>
</html>